<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Virtual Guest Ordering - https://softlayer.github.io/</title>
    <link rel="canonical" href="https://softlayer.github.io/blog/sthompson/Virtual-Guest-Ordering/">
        <link rel="stylesheet" href="https://softlayer.github.io/css/main.css">
    <link href="https://softlayer.github.io/css/bootstrap.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/font-awesome.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/custom.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://softlayer.github.io/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://softlayer.github.io/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://softlayer.github.io/js/jquery-3.3.1.min.js"></script> 
    <script src="https://softlayer.github.io/js/sldn.js"></script>

    
	<script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-88235803-1', 'auto');
ga('send', 'pageview');
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://softlayer.github.io/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://softlayer.github.io/article/">Articles</a></li>
                    
                        <li><a href="https://softlayer.github.io/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://softlayer.github.io/go/">Go</a></li>
                    
                        <li><a href="https://softlayer.github.io/php/">PHP</a></li>
                    
                        <li><a href="https://softlayer.github.io/perl/">Perl</a></li>
                    
                        <li><a href="https://softlayer.github.io/python/">Python</a></li>
                    
                        <li><a href="https://softlayer.github.io/rest/">Rest</a></li>
                    
                        <li><a href="https://softlayer.github.io/ruby/">Ruby</a></li>
                    
                        <li><a href="https://softlayer.github.io/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:softlayer.github.io" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>January 11, 2011<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/blog">blog</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm release-note" style="word-wrap: break-word;">
				<h3>Virtual Guest Ordering<br> <small>&lt;p&gt;&lt;i&gt;Note: This process for ordering CCIs has been deprecated. Please see the updated process &lt;a href=http://sldn.soft</small></h3>
				
                
				
                <p><p><i>Note: This process for ordering CCIs has been deprecated. Please see the updated process <a href="http://sldn.softlayer.com/blog/phil/Simplified-CCI-Creation">here</a>. However this blog contains current information regarding ordering complex CCI solutions and all other products.</i></p>
<p>The universe is a strange place.</p>
<p>Many times in my life there have been occasions where I will run into the same concept, or the same question repeatedly within a short span of time. Perhaps It&rsquo;s more a question of perception than cosmic coincidence, but the phenomenon itself is real. Philosophical musings aside, however, we have had several customers, from different quarters of our business, all asking the same question this past week &ldquo;How do I order a virtual guest through the SoftLayer API?&rdquo;.</p>
<p>Here at the SLDN blog, we&rsquo;ve looked at that task before. The <a href="http://sldn.softlayer.com/04/2010/our-python-client-is-out/">blog post which introduces the Python client</a> shows one method of ordering a virtual guest. In that blog post, a new virtual guest is created by cloning the setup of an existing virtual guest. It works well if you have an existing guest to clone. If you do not have an existing guest, however, the task requires a bit more background information. This post will present that background and offer a sample that orders a virtual guest from scratch.</p>
<p>To order a product from SoftLayer through the API, you first create an entity known as the Order Container. The order container is a structure that you will pass to the method <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Order::verifyOrder"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Order::verifyOrder</code></span></a> and then to <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Order::placeOrder"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Order::placeOrder</code></span></a>.</p>
<p>Logistically, an order container is simply a structure with fields defined by its type. The goal of your code is to create one of these structures and fill out the necessary fields. The SoftLayer API allows you to work with several kinds of Order Containers. Just to name a few:</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Virtual_Guest</code></span></a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Hardware_Server</code></span></a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Software_Component"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Software_Component</code></span></a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Security_Certificate"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Security_Certificate</code></span></a></li>
</ul>
<p>(You can get a list of these containers by searching the SLDN wiki for the phrase &ldquo;<a href="http://sldn.softlayer.com/search/apachesolr_search/Softlayer%20container%20product">SoftLayer Container Product</a>&rdquo;).</p>
<p>The first one above, <a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Virtual_Guest</code></span></a>, is the one you use when ordering a virtual guest.</p>
<p>In this example, we will be using the <a href="http://rubygems.org/gems/softlayer_api"><span class="geshifilter"><code class="text geshifilter-text">softlayer_api</code></span></a> Ruby gem. Ruby represents the structures you pass to the API as Hashes. The portion of the code that creates our order container looks like this:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;"><span style="color:#ff6633; font-weight:bold;">$product_order</span> = <span style="color:#006600; font-weight:bold;">&#123;</span>
    <span style="color:#996600;">&lsquo;complexType&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;SoftLayer_Container_Product_Order_Virtual_Guest&rsquo;</span>,
    <span style="color:#996600;">&lsquo;quantity&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1</span>,      <span style="color:#008000; font-style:italic;"># We only want 1 virtual guest.</span>
&nbsp;
    <span style="color:#008000; font-style:italic;"># In this example we&rsquo;re creating a single virtual guest. The &ldquo;virtualGuests&rdquo; portion of the</span>
    <span style="color:#008000; font-style:italic;"># order container gives the system important information about the guests being created.</span>
    <span style="color:#008000; font-style:italic;"># in this case we provide the host and domain IDs for the virtual guest we are creating</span>
    <span style="color:#008000; font-style:italic;">#</span>
    <span style="color:#008000; font-style:italic;"># If you were creating more than one virtual guest, the array would contain more than</span>
    <span style="color:#008000; font-style:italic;"># one entry.</span>
    <span style="color:#996600;">&lsquo;virtualGuests&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006600; font-weight:bold;">&#91;</span>
      <span style="color:#006600; font-weight:bold;">&#123;</span>
          <span style="color:#996600;">&lsquo;hostname&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;test2&rsquo;</span>,      <span style="color:#008000; font-style:italic;"># in your own code you would replace this with your own hostname</span>
          <span style="color:#996600;">&lsquo;domain&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;example.com&rsquo;</span>   <span style="color:#008000; font-style:italic;"># in your own code you would replace this with your own domain name</span>
      <span style="color:#006600; font-weight:bold;">&#125;</span>
    <span style="color:#006600; font-weight:bold;">&#93;</span>,
&nbsp;
    <span style="color:#996600;">&lsquo;location&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,
    <span style="color:#996600;">&lsquo;packageId&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,
    <span style="color:#996600;">&lsquo;prices&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,
<span style="color:#006600; font-weight:bold;">&#125;</span></pre></div>
<p>First the code sets the <span class="geshifilter"><code class="text geshifilter-text">complexType</code></span> field of the structure to the string &ldquo;<span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Container_Product_Order_Virtual_Guest</code></span>&rdquo;. This hint tells the server how to interpret the fields of the structure. We only want 1 virtual guest in this example so we set the <span class="geshifilter"><code class="text geshifilter-text">quantity</code></span> field to 1. For a Virtual Guest order, the system will want to know the host and domain names of each new computing device. This is accomplished by assigning an array of structures to the <span class="geshifilter"><code class="text geshifilter-text">virtualGuests</code></span> field. In this case we are only ordering 1 guest so the array contains a single item.</p>
<p>The other three fields in the structure, <span class="geshifilter"><code class="text geshifilter-text">packageId</code></span>, <span class="geshifilter"><code class="text geshifilter-text">location</code></span> and <span class="geshifilter"><code class="text geshifilter-text">prices</code></span> will require just a bit more explanation.</p>
<p>A <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Package_%28type%29">SoftLayer_Product_Package</a>, or &ldquo;Package&rdquo; for short, is a fundamental building block of the order. The Package tells the system what kind of thing you are trying to order, be it a server, a virtual guest, a security certificate, etc. The <span class="geshifilter"><code class="text geshifilter-text">getActivePackages</code></span> method in the <span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Account</code></span> service returns a list of the packages available for purchase. Virtual Guests are ordered from a package with a well known ID, <span class="geshifilter"><code class="text geshifilter-text">46</code></span>. Our sample code takes advantage of this fact by hard-coding the ID of that package. The <span class="geshifilter"><code class="text geshifilter-text">packageId</code></span> field of our order sample is simply set to the value <span class="geshifilter"><code class="text geshifilter-text">46</code></span>.</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;">Virtual_Guest_Package_ID = <span style="color:#006666;">46</span>
<span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;packageId&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = Virtual_Guest_Package_ID</pre></div>
<p>The <span class="geshifilter"><code class="text geshifilter-text">location</code></span> field of the order container identifies where, geographically speaking, we would like our virtual guest created. SoftLayer has a number of data centers across the globe and the system needs to know which will house your virtual guest. The Package service can tell you which of SoftLayer&rsquo;s data centers can house the server ordered by a particular Package. You can call the <span class="geshifilter"><code class="text geshifilter-text">getLocations</code></span> and <span class="geshifilter"><code class="text geshifilter-text">getAvailableLocations</code></span> methods of the <span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Package</code></span> service (along with the Package ID) to find out in which locations a given package is valid. In the sample code, we chose a fixed location, the Dallas 5 data center for our order and the location ID is hard coded to that ID:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;">Dallas_Location_ID = <span style="color:#006666;">138124</span>
<span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;location&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = Dallas_Location_ID;</pre></div>
<p>(this code first defines the symbolic constant <span class="geshifilter"><code class="text geshifilter-text">Dallas_Location_ID</code></span> to make the code a tiny bit more readable)</p>
<p>The only field left to fill out in our order container is the <span class="geshifilter"><code class="text geshifilter-text">prices</code></span> field. This field must be set to an array, the entries of which are instances of the <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Item_Price"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Item_Price</code></span></a> data type. For the sake of this discussion, we&rsquo;ll shorten that name to ItemPrice.</p>
<p>An ItemPrice corresponds roughly to a configuration option you would like to choose for your server. There will be one ItemPrice for a server that has 2GB of RAM and a different ItemPrice for a server with 4GB of RAM. Your server will be configured based on which of these ItemPrices you include in the order container.</p>
<p>ItemPrices are collected together into groups called a <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Item_Category"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Item_Category</code></span></a> or just ItemCategory for short. To continue the example from above, the ItemPrices for the 2GB and 4GB configuration options are both in the same ItemCategory. That ItemCategory represents the collection of configuration options related to server RAM.</p>
<p>Each Package is aware of a list of ItemCategories that make sense for that Package. This list is called the Packages &ldquo;Configuration&rdquo;. Within the configuration, the Package may identify certain categories that are required, meaning you must include an ItemPrice from that category in any order you make against that Package. For example, before a virtual guest package is complete, and before you can order that package, you must specify how much RAM you want to configure on the resulting Virtual Guest. The Configuration of the Virtual Guest Package will mark the RAM category as a required category. If you submit an order against that package without an ItemPrice from the RAM ItemCategory, your order will be rejected.</p>
<p>You can retrieve the Configuration of a Package with the <span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Package::getConfiguration</code></span> method. The result of making this call is an array of the ItemCategories that make up the package with certain elements of that array being identified as &ldquo;required&rdquo; to complete the Package. The sample code includes a block that retrieves the Configuration for the Virtual Guest package and prints out a list of the required ItemCategories:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;Required Categories:&rdquo;</span>
virtual_guest_configuration = <span style="color:#ff6633; font-weight:bold;">$virtual_guest_package</span>.<span style="color:#9900CC;">object_mask</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;isRequired&rdquo;</span>,<span style="color:#996600;">&ldquo;itemCategory&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">getConfiguration</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
required_categories = virtual_guest_configuration.<span style="color:#CC0066; font-weight:bold;">select</span> <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span> <span style="color:#006666;">1</span> = = configuration_entry<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&lsquo;isRequired&rsquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> <span style="color:#006600; font-weight:bold;">&#125;</span>
required_categories.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span>
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;<span style="color:#000099;">\t</span>#{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;id&rsquo;]} &ndash; #{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;name&rsquo;]}&rdquo;</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></div>
<p>The result of this executing code will resemble something like:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;">Required Categories:
    <span style="color:#006666;">80</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Computing Instance
    <span style="color:#006666;">3</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Ram
    <span style="color:#006666;">46</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Remote Management
    <span style="color:#006666;">26</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Uplink Port Speeds
    <span style="color:#006666;">10</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Public Bandwidth
    <span style="color:#006666;">13</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Primary IP Addresses
    <span style="color:#006666;">81</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> First Disk
    <span style="color:#006666;">12</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Operating <span style="color:#CC0066; font-weight:bold;">System</span>
    <span style="color:#006666;">20</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Monitoring
    <span style="color:#006666;">21</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Notification
    <span style="color:#006666;">22</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Response
    <span style="color:#006666;">31</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> VPN Management <span style="color:#006600; font-weight:bold;">-</span> Private Network
    <span style="color:#006666;">32</span> <span style="color:#006600; font-weight:bold;">&ndash;</span> Vulnerability Assessments <span style="color:#006600; font-weight:bold;">&amp;</span>amp; Management</pre></div>
<p>This is a list of the ids and names of the required categories for the virtual guest ordering package<br />
To complete an order for a virtual guest, you will have to select one ItemPrice from each of these required categories and put them into the &ldquo;prices&rdquo; field of the order container. For most orders, you will select one ItemPrice from each category in a configuration. It should be noted, however, that it is possible to select incompatible combinations of ItemPrices and wind up with an invalid order. For example, if you ask for unlimited bandwidth with a 100 Mbps uplink, but configure the virtual guest to have 10 Mbps port speeds, then <span class="geshifilter"><code class="text geshifilter-text">verifyOrder</code></span> will reject your order.<br />
The code sample includes another block of code designed to show how ItemPrices relate to categories:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;">item_prices = <span style="color:#ff6633; font-weight:bold;">$virtual_guest_package</span>.<span style="color:#9900CC;">object_mask</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;id&rdquo;</span>, <span style="color:#996600;">&ldquo;item.description&rdquo;</span>, <span style="color:#996600;">&ldquo;categories.id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">getItemPrices</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
required_categories.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span>
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;Category <span style="color:#000099;">\&ldquo;</span>#{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;name&rsquo;]}<span style="color:#000099;">\&ldquo;</span>:&rdquo;</span>
  category_prices = item_prices.<span style="color:#9900CC;">map</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>item<span style="color:#006600; font-weight:bold;">|</span>
  item<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;categories&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span>.<span style="color:#9900CC;">map</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>category<span style="color:#006600; font-weight:bold;">|</span>
  item <span style="color:#9966CC; font-weight:bold;">if</span> category<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> == configuration_entry<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;itemCategory&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span>
    <span style="color:#9966CC; font-weight:bold;">end</span> <span style="color:#9966CC; font-weight:bold;">if</span> item.<span style="color:#9966CC; font-weight:bold;">include</span>?<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;categories&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
    <span style="color:#9966CC; font-weight:bold;">end</span>.<span style="color:#9900CC;">flatten</span>.<span style="color:#9900CC;">compact</span>
  category_prices.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>category_price<span style="color:#006600; font-weight:bold;">|</span>
    <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;<span style="color:#000099;">\t</span> #{category_price[&lsquo;id&rsquo;]} &ndash; #{category_price[&lsquo;item&rsquo;][&lsquo;description&rsquo;]}&rdquo;</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></div>
<p>This code uses the <span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Package::getItemPrices</code></span> method to get a list of all the item prices that are valid in the virtual guest package.  It then uses the required categories, returned by the previous code, to print out a list of all the valid item prices in each required category.  A portion of the output of this code snippet will look something like this:</p>
<div class="geshifilter">
<pre class="text geshifilter-text" style="font-family:monospace;">Category &ldquo;Remote Management&rdquo;:
     905 &ndash; Reboot / Remote Console
Category &ldquo;Uplink Port Speeds&rdquo;:
     273 &ndash; 100 Mbps Public &amp; Private Networks
     272 &ndash; 10 Mbps Public &amp; Private Networks
     274 &ndash; 1000 Mbps Public &amp; Private Networks
Category &ldquo;Public Bandwidth&rdquo;:
     125 &ndash; Unlimited Bandwidth (100 Mbps Uplink)
     1800 &ndash; 0 GB Bandwidth
     34 &ndash; 2000 GB Bandwidth
     130 &ndash; 8000 GB Bandwidth
     127 &ndash; 4000 GB Bandwidth
     131 &ndash; 10000 GB Bandwidth
     36 &ndash; Unlimited Bandwidth (10 Mbps Uplink)
     2358 &ndash; 3000 GB Bandwidth
     129 &ndash; 6000 GB Bandwidth
     613 &ndash; 1000 GB Bandwidth
Category &ldquo;Primary IP Addresses&rdquo;:
     21 &ndash; 1 IP Address
Category &ldquo;First Disk&rdquo;:
     2202 &ndash; 25 GB (SAN)
     1639 &ndash; 100 GB (SAN)</pre></div>
<p>Here we see each required category, listed by name, followed by the with the ItemPrices found in that category. Each ItemPrice is identified by its ID and name. The ID number of each item is what we are primarily interested in here.  The code sample places these IDs in objects within the &ldquo;prices&rdquo; array within the Product Order Container to complete the product order.</p>
<p>The sample does that with the following code, just before calling <span class="geshifilter"><code class="text geshifilter-text">verifyOrder</code></span>:</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;"><span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;prices&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = <span style="color:#006600; font-weight:bold;">&#91;</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1641</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;"># 1641 &ndash; 2 x 2.0 GHz Cores [Computing Instance]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1647</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;"># 1647 &ndash; 8 GB [Ram]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">905</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;"># 905 &ndash; Reboot / Remote Console [Remote Management]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">273</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;"># 273 &ndash; 100 Mbps Public &amp; Private Networks [Uplink Port Speeds]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">125</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;"># 125 &ndash; Unlimited Bandwidth (100 Mbps Uplink) [Public Bandwidth]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">21</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;"># 21 &ndash; 1 IP Address [Primary IP Addresses]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1639</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;"># 1639 &ndash; 100 GB (SAN)  [First Disk]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1685</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;"># 1685 &ndash; CentOS 5 - Minimal Install (64 bit)  [Operating System]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">55</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;"># 55 &ndash; Host Ping [Monitoring]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">57</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;"># 57 &ndash; Email and Ticket [Notification]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">58</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;"># 58 &ndash; Automated Notification [Response]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">420</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;"># 420 &ndash; Unlimited SSL VPN Users &amp; 1 PPTP VPN User per account [VPN Management - Private Network]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">418</span> <span style="color:#006600; font-weight:bold;">&#125;</span>   <span style="color:#008000; font-style:italic;"># 418 &ndash; Nessus Vulnerability Assessment &amp; Reporting [Vulnerability Assessments &amp; Management]</span>
<span style="color:#006600; font-weight:bold;">&#93;</span></pre></div>
<p>Note that the prices array is an array of ItemPrice objects, but we only need to specify the ID of each object.  The comment after each line identifies the ID of the particular ItemPrice, it&rsquo;s name, and (in square brackets) the name of the category from which that ItemPrice was chosen.</p>
<p>With the prices field populated, the order container is complete.  As mentioned when we began, you should submit the order to <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Order::verifyOrder"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Order::verifyOrder</code></span></a>.  This method will check the order for any errors.  If errors are found, it will return an error object, otherwise it will return a fully populated Order Container with all the necessary fields filled out.  You may then pass this fully populated order container to <a href="http://sldn.softlayer.com/wiki/index.php/SoftLayer_Product_Order::placeOrder"><span class="geshifilter"><code class="text geshifilter-text">SoftLayer_Product_Order::placeOrder</code></span></a>.</p>
<p>Below is the complete code example.  It takes includes the code above that prints out information from the configuration and ItemPrice lists. It puts together an order container and submits it to <span class="geshifilter"><code class="text geshifilter-text">verifyOrder</code></span> (but does not actually try to place the order).</p>
<p>This blog post has presented some of the fundamental concepts of the SoftLayer ordering system and we hope you will find the information useful in your own code.</p>
<div class="geshifilter">
<pre class="ruby geshifilter-ruby" style="font-family:monospace;"><span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">&lsquo;rubygems&rsquo;</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">&lsquo;softlayer_api&rsquo;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># Set the API key and username using the globals so that we don&rsquo;t have to </span>
<span style="color:#008000; font-style:italic;"># specify them repeatedly.  Substitute your own username and API key in these spots</span>
<span style="color:#ff6633; font-weight:bold;">$SL_API_USERNAME</span> = <span style="color:#996600;">&lsquo;username&rsquo;</span>
<span style="color:#ff6633; font-weight:bold;">$SL_API_KEY</span> = <span style="color:#996600;">&lsquo;deadbeefbadf00d&hellip;&rsquo;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># These are the services we&rsquo;ll be using</span>
softlayer_product_package = <span style="color:#6666ff; font-weight:bold;">SoftLayer::Service</span>.<span style="color:#9900CC;">new</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;SoftLayer_Product_Package&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
softLayer_product_item_price = <span style="color:#6666ff; font-weight:bold;">SoftLayer::Service</span>.<span style="color:#9900CC;">new</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;SoftLayer_Product_Item_Price&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
softLayer_product_order = <span style="color:#6666ff; font-weight:bold;">SoftLayer::Service</span>.<span style="color:#9900CC;">new</span><span style="color:#006600; font-weight:bold;">&#40;</span> <span style="color:#996600;">&ldquo;SoftLayer_Product_Order&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
&nbsp;
<span style="color:#008000; font-style:italic;"># Our goal for this code is to is to fill out a structure known as the SoftLayer_Container_Product_Order_Virtual_Guest</span>
<span style="color:#008000; font-style:italic;"># The following hash is the template for a virtual guest order and the code that follows will modify this template</span>
<span style="color:#008000; font-style:italic;"># to create a valid order. Once complete, we&rsquo;ll send this order to be validated. Production code could then submit the</span>
<span style="color:#008000; font-style:italic;"># completed order</span>
<span style="color:#ff6633; font-weight:bold;">$product_order</span> = <span style="color:#006600; font-weight:bold;">&#123;</span>
    <span style="color:#996600;">&lsquo;complexType&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;SoftLayer_Container_Product_Order_Virtual_Guest&rsquo;</span>,  <span style="color:#008000; font-style:italic;"># a constant that will tell the server what type of thing we&rsquo;re sending it.</span>
&nbsp;
    <span style="color:#996600;">&lsquo;quantity&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1</span>,      <span style="color:#008000; font-style:italic;"># We only want 1 virtual guest.</span>
&nbsp;
    <span style="color:#008000; font-style:italic;"># In this example we&rsquo;re creating a single virtual guest. The &ldquo;virtualGuests&rdquo; portion of the</span>
    <span style="color:#008000; font-style:italic;"># order container gives the system important information about the guests being created.</span>
    <span style="color:#008000; font-style:italic;"># in this case we provide the host and domain IDs for the virtual guest we are creating</span>
    <span style="color:#008000; font-style:italic;">#</span>
    <span style="color:#008000; font-style:italic;"># If you were creating more than one virtual guest, the array would contain more than</span>
    <span style="color:#008000; font-style:italic;"># one entry.</span>
    <span style="color:#996600;">&lsquo;virtualGuests&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006600; font-weight:bold;">&#91;</span>
      <span style="color:#006600; font-weight:bold;">&#123;</span>
          <span style="color:#996600;">&lsquo;hostname&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;test2&rsquo;</span>,      <span style="color:#008000; font-style:italic;"># in your own code you would replace this with your own hostname</span>
          <span style="color:#996600;">&lsquo;domain&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&lsquo;example.com&rsquo;</span>   <span style="color:#008000; font-style:italic;"># in your own code you would replace this with your own domain name</span>
      <span style="color:#006600; font-weight:bold;">&#125;</span>
    <span style="color:#006600; font-weight:bold;">&#93;</span>,
&nbsp;
    <span style="color:#008000; font-style:italic;"># These are fields we&rsquo;ll fill in below with more explaination </span>
&nbsp;
    <span style="color:#996600;">&lsquo;location&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,    <span style="color:#008000; font-style:italic;"># The geographic location where the virtual guest will be instantiated. We&rsquo;ll set this below.</span>
    <span style="color:#996600;">&lsquo;packageId&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,   <span style="color:#008000; font-style:italic;"># The package we are trying to order.  Explained in more detail shortly.</span>
    <span style="color:#996600;">&lsquo;prices&rsquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#0000FF; font-weight:bold;">nil</span>,      <span style="color:#008000; font-style:italic;"># Filling out this array properly will account for much of the code and commentary to follow.</span>
<span style="color:#006600; font-weight:bold;">&#125;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># Product orders are built from Packages. The Package describes the entity you are trying to order (be it a Dedicated Server </span>
<span style="color:#008000; font-style:italic;"># or Virtual Guest). You can request a list of the Packages available for purchase on a particular account by calling the </span>
<span style="color:#008000; font-style:italic;"># getActivePackages method in the SoftLayer_Account service.</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># For our needs here, however, the package that handles Virtual Guests is a &ldquo;well known&rdquo; package ID, 46. So </span>
<span style="color:#008000; font-style:italic;"># we&rsquo;ll just use that as a hard-coded constant.</span>
Virtual_Guest_Package_ID = <span style="color:#006666;">46</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># set the package id in the product order</span>
<span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;packageId&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = Virtual_Guest_Package_ID
&nbsp;
<span style="color:#008000; font-style:italic;"># This creates a proxy of the product package service with the virtual guest package ID already</span>
<span style="color:#008000; font-style:italic;"># &ldquo;integrated&rdquo; into it.</span>
<span style="color:#ff6633; font-weight:bold;">$virtual_guest_package</span> = softlayer_product_package.<span style="color:#9900CC;">object_with_id</span><span style="color:#006600; font-weight:bold;">&#40;</span>Virtual_Guest_Package_ID<span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># The &ldquo;locations&rdquo; of a Package tell you where (geographically speaking) that package can be used. Asking the package for it&rsquo;s</span>
<span style="color:#008000; font-style:italic;"># locations will return an array of valid locations. Each location is identified by an ID. For example, at the time of this writing</span>
<span style="color:#008000; font-style:italic;"># if you ask the virtual guest package for locations and their availability:</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># puts $virtual_guest_package.getLocations().inspect</span>
<span style="color:#008000; font-style:italic;"># puts $virtual_guest_package.getAvailableLocations().inspect</span>
<span style="color:#008000; font-style:italic;"># </span>
<span style="color:#008000; font-style:italic;"># You would learn that the &ldquo;dal05&rdquo; location (aka &ldquo;Dallas 5&rdquo;, not to be confused with Johnny 5) has the id 138124. Other valid </span>
<span style="color:#008000; font-style:italic;"># locations are returned by the same call. For our product order we&rsquo;re going to order in Dallas 5 so we&rsquo;ll set the ID to 138124</span>
Dallas_Location_ID = <span style="color:#006666;">138124</span>
<span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;location&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = Dallas_Location_ID;
&nbsp;
<span style="color:#008000; font-style:italic;"># A product order is made up of ItemPrices. An ItemPrice corresponds to a particular configuration option for a server.</span>
<span style="color:#008000; font-style:italic;"># for example, One ItemPrice will correspond to having two cores in a server and a separate item price will correspond to </span>
<span style="color:#008000; font-style:italic;"># having four cores in the server.</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># ItemPrices come in collections called ItemCategories. The ItemPrice objects for 2 cores vs. 4 cores both fall within </span>
<span style="color:#008000; font-style:italic;"># the same ItemCategory (an item category that expresses the number of cores on a particular server).</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># ItemPrices are represented in the API as instances of the SoftLayer_Product_Item_Price data type</span>
<span style="color:#008000; font-style:italic;"># ItemCategories are represented as instances of the SoftLayer_Product_Item_Category data type</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># A Configuration is the list of ItemCategories that are valid for a Package. By asking a package for it&rsquo;s configuration </span>
<span style="color:#008000; font-style:italic;"># you can also find out which ItemCategories are required by that package. When you submit an order, you must select one </span>
<span style="color:#008000; font-style:italic;"># ItemPrice from each of the required ItemCategories and include that in the order&rsquo;s price list. Of course, you may also </span>
<span style="color:#008000; font-style:italic;"># elect to include ItemPrices from categories that are not required if you would like.</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># The list returned from calling getConfiguration is an instance of the SoftLayer_Product_Package_Order_ConfigurationArray data type</span>
<span style="color:#008000; font-style:italic;"># </span>
<span style="color:#008000; font-style:italic;"># The following code asks the Virtual Guest package for it&rsquo;s configuration and prints out the names of all the </span>
<span style="color:#008000; font-style:italic;"># required categories.</span>
<span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;Required Categories:&rdquo;</span>
virtual_guest_configuration = <span style="color:#ff6633; font-weight:bold;">$virtual_guest_package</span>.<span style="color:#9900CC;">object_mask</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;isRequired&rdquo;</span>,<span style="color:#996600;">&ldquo;itemCategory&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">getConfiguration</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
required_categories = virtual_guest_configuration.<span style="color:#CC0066; font-weight:bold;">select</span> <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span> <span style="color:#006666;">1</span> = = configuration_entry<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&lsquo;isRequired&rsquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> <span style="color:#006600; font-weight:bold;">&#125;</span>
required_categories.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span>
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;<span style="color:#000099;">\t</span>#{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;id&rsquo;]} &ndash; #{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;name&rsquo;]}&rdquo;</span>
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># To create a valid order, we have to include one ItemPrice from each category in the required categories list</span>
<span style="color:#008000; font-style:italic;"># You can ask the Package for a list of all the ItemPrices and then examine the ItemPrices to find out which categories</span>
<span style="color:#008000; font-style:italic;"># they are in.</span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># The following code grabs the list of ItemPrices for the virtual guest package and uses the required categories</span>
<span style="color:#008000; font-style:italic;"># from that package to create a sorted list of installable options. By selecting one price from each required</span>
<span style="color:#008000; font-style:italic;"># category and putting that price into the product order we should get a valid order so long as the price items</span>
<span style="color:#008000; font-style:italic;"># are not incompatible with one another for other reasons.</span>
<span style="color:#008000; font-style:italic;">#</span>
item_prices = <span style="color:#ff6633; font-weight:bold;">$virtual_guest_package</span>.<span style="color:#9900CC;">object_mask</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;id&rdquo;</span>, <span style="color:#996600;">&ldquo;item.description&rdquo;</span>, <span style="color:#996600;">&ldquo;categories.id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">getItemPrices</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
required_categories.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>configuration_entry<span style="color:#006600; font-weight:bold;">|</span>
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;Category <span style="color:#000099;">\&ldquo;</span>#{configuration_entry[&lsquo;itemCategory&rsquo;][&lsquo;name&rsquo;]}<span style="color:#000099;">\&ldquo;</span>:&rdquo;</span>
    category_prices = item_prices.<span style="color:#9900CC;">map</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>item<span style="color:#006600; font-weight:bold;">|</span>
    item<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;categories&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span>.<span style="color:#9900CC;">map</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>category<span style="color:#006600; font-weight:bold;">|</span>
    item <span style="color:#9966CC; font-weight:bold;">if</span> category<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> == configuration_entry<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;itemCategory&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;id&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span>
      <span style="color:#9966CC; font-weight:bold;">end</span> <span style="color:#9966CC; font-weight:bold;">if</span> item.<span style="color:#9966CC; font-weight:bold;">include</span>?<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&ldquo;categories&rdquo;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
      <span style="color:#9966CC; font-weight:bold;">end</span>.<span style="color:#9900CC;">flatten</span>.<span style="color:#9900CC;">compact</span>
  category_prices.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>category_price<span style="color:#006600; font-weight:bold;">|</span>
    <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;<span style="color:#000099;">\t</span> #{category_price[&lsquo;id&rsquo;]} &ndash; #{category_price[&lsquo;item&rsquo;][&lsquo;description&rsquo;]}&rdquo;</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># Using the ID&rsquo;s taken from the lists printed by the code up to this point we can put together a virtual guest</span>
<span style="color:#008000; font-style:italic;"># without having to use a previous virtual guest as a template. </span>
<span style="color:#008000; font-style:italic;">#</span>
<span style="color:#008000; font-style:italic;"># In the array we have selected one ItemPrice from each of the required categories so now we can put them</span>
<span style="color:#008000; font-style:italic;"># in the template. Really all we need in the template is the ItemPrice ID&rsquo;s and the order system can </span>
<span style="color:#008000; font-style:italic;"># pick up the actual price objects on the server side.  The comment after each price object in the array</span>
<span style="color:#008000; font-style:italic;"># shows the ID and name of the ItemPrice as well as the name of the category from which it was taken.</span>
&nbsp;
<span style="color:#ff6633; font-weight:bold;">$product_order</span><span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#996600;">&ldquo;prices&rdquo;</span><span style="color:#006600; font-weight:bold;">&#93;</span> = <span style="color:#006600; font-weight:bold;">&#91;</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1641</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;">#   1641 &ndash; 2 x 2.0 GHz Cores [Computing Instance]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1647</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;">#   1647 &ndash; 8 GB [Ram]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">905</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;">#   905 &ndash; Reboot / Remote Console [Remote Management]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">273</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;">#   273 &ndash; 100 Mbps Public &amp; Private Networks [Uplink Port Speeds]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">125</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;">#   125 &ndash; Unlimited Bandwidth (100 Mbps Uplink) [Public Bandwidth]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">21</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;">#   21 &ndash; 1 IP Address [Primary IP Addresses]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1639</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;">#   1639 &ndash; 100 GB (SAN)  [First Disk]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">1685</span> <span style="color:#006600; font-weight:bold;">&#125;</span>, <span style="color:#008000; font-style:italic;">#   1685 &ndash; CentOS 5 - Minimal Install (64 bit)  [Operating System]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">55</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;">#   55 &ndash; Host Ping [Monitoring]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">57</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;">#   57 &ndash; Email and Ticket [Notification]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">58</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,   <span style="color:#008000; font-style:italic;">#   58 &ndash; Automated Notification [Response]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">420</span> <span style="color:#006600; font-weight:bold;">&#125;</span>,  <span style="color:#008000; font-style:italic;">#   420 &ndash; Unlimited SSL VPN Users &amp; 1 PPTP VPN User per account [VPN Management - Private Network]</span>
  <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#996600;">&ldquo;id&rdquo;</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">418</span> <span style="color:#006600; font-weight:bold;">&#125;</span>   <span style="color:#008000; font-style:italic;">#   418 &ndash; Nessus Vulnerability Assessment &amp; Reporting [Vulnerability Assessments &amp; Management]</span>
<span style="color:#006600; font-weight:bold;">&#93;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># At this point, the order should be complete. We pass it to verifyOrder to make sure</span>
<span style="color:#008000; font-style:italic;"># it is valid.  Afterward, you could pass it to placeOrder to actually get the ball rolling.</span>
<span style="color:#9966CC; font-weight:bold;">begin</span>
  result = softLayer_product_order.<span style="color:#9900CC;">verifyOrder</span><span style="color:#006600; font-weight:bold;">&#40;</span>$product_order<span style="color:#006600; font-weight:bold;">&#41;</span>
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;The order was verified successfully&rdquo;</span>
<span style="color:#9966CC; font-weight:bold;">rescue</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> error_reason
  <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">&ldquo;The order could not be verified by the server #{error_reason}&rdquo;</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></div></p>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
            
        <div class="col-md-6">
            
<div class="panel panel-default">
    <div class="panel-heading" style="padding: 2px 15px;">
        <h4>More Documentation</h4>
    </div>
    <div class="panel-body">
        <a href="https://softlayer.github.com/reference/softlayerapi"><i class="fa fa-link"></i> SoftLayer API Reference<br></a>
        <a href="https://github.com/softlayer/softlayer-java"><i class="fa fa-github"></i> softlayer-java<br></a>
        <a href="https://github.com/softlayer/softlayer-api-perl-client"><i class="fa fa-github"></i> softlayer-perl<br></a>
        <a href="https://github.com/softlayer/softlayer-api-php-client"><i class="fa fa-github"></i> softlayer-php<br></a>
        <a href="https://github.com/softlayer/softlayer-python"><i class="fa fa-github"></i> softlayer-python<br></a>
        <a href="https://github.com/softlayer/softlayer-ruby"><i class="fa fa-github"></i> softlayer-ruby<br></a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading text-center" style="padding: 2px 15px;">
      <a href="https://www.facebook.com/IBMBluemixIaaS/"><i class="fa fa-facebook-square" alt="facebook"></i> </a>
      <a href="https://twitter.com/IBMBluemixIaaS"><i class="fa fa-twitter" alt="twitter"></i> </a>
      <a href="http://www.linkedin.com/company/softlayer-technologies-inc-" alt="linked-in"><i class="fa fa-linkedin-square"></i> </a>
      <a href="https://github.com/softlayer"><i class="fa fa-github" alt="github"></i> </a>
      <a href="irc://irc.freenode.net/softlayer"><i class="fa fa-comment" alt="irc"></i> </a>
    </div>
</div>

        </div>
        <div class="col-md-6">
            <div class="well well-sm" style="word-wrap: break-word;"> 
                <strong>Feedback? <span class="fa fa-comment"/></strong>
                    <p>
                        We would love to hear it<br>
                        <a class="" href="https://github.com/softlayer/api_examples/issues/new?title=Feedback%20for%20blog%20-%20Virtual%20Guest%20Ordering&body=Feedback+regarding%3A%20https%3a%2f%2fsoftlayer.github.io%2fblog%2fsthompson%2fVirtual-Guest-Ordering%2f"><span class="fa fa-github-square"/> Open an issue</a>
                    </p>
            </div>
        </div>

    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2015<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://softlayer.github.io/js/jquery.js"></script>
    <script src="https://softlayer.github.io/js/bootstrap.js"></script>
</body>
</html>

/blog/sthompson/Virtual-Guest-Ordering/
