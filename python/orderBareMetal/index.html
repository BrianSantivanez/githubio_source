<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Advanced Bare Metal Server Ordering - https://softlayer.github.io/</title>
    <link rel="canonical" href="https://softlayer.github.io/python/orderBareMetal/">
        <link rel="stylesheet" href="https://softlayer.github.io/css/main.css">
    <link href="https://softlayer.github.io/css/bootstrap.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/font-awesome.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/custom.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://softlayer.github.io/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://softlayer.github.io/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://softlayer.github.io/js/jquery-3.3.1.min.js"></script> 
    <script src="https://softlayer.github.io/js/sldn.js"></script>

    
	<script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-88235803-1', 'auto');
ga('send', 'pageview');
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://softlayer.github.io/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://softlayer.github.io/article/">Articles</a></li>
                    
                        <li><a href="https://softlayer.github.io/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://softlayer.github.io/go/">Go</a></li>
                    
                        <li><a href="https://softlayer.github.io/php/">PHP</a></li>
                    
                        <li><a href="https://softlayer.github.io/perl/">Perl</a></li>
                    
                        <li><a href="https://softlayer.github.io/python/">Python</a></li>
                    
                        <li><a href="https://softlayer.github.io/rest/">Rest</a></li>
                    
                        <li><a href="https://softlayer.github.io/ruby/">Ruby</a></li>
                    
                        <li><a href="https://softlayer.github.io/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:softlayer.github.io" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>September 13, 2017<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Product_Order">SoftLayer_Product_Order</a>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Configuration_Storage_Group_Array_Type">SoftLayer_Configuration_Storage_Group_Array_Type</a>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Product_Package">SoftLayer_Product_Package</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/order">order</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/vlan">vlan</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/bare-metal">bare-metal</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/create">create</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/filter">filter</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/hardware">hardware</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/objectfilter">objectfilter</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/packages">packages</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/pricing">pricing</a>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/raid">raid</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm release-note" style="word-wrap: break-word;">
				<h3>Advanced Bare Metal Server Ordering<br> <small>Explains how to build a bare metal order, includes how to get packages, prices, raid setup and vlans</small></h3>
				
                
				
                

<p>Example of how to build an order for a bare metal server.</p>

<ol>
<li>Find the package that you want to order. listServerPackages() will filter out all that are not bare metal servers</li>
<li>Use getServerPrices() to find the item keyNames you want to include in your order. These price IDs can be included prices array directly, but I&rsquo;ve included gatherPriceIds() to match up KeyNames to build a list of price ids. getServerPrices() will also show the locations available for ordering.</li>
<li>listAvailableVlans() if you want to place the server on a specific VLAN.</li>
<li>listPartitionTemplates() will show what partition schemes you can apply to a disk.</li>
<li>listRaidArrayTypes() shows what id numbers are for each RAID type.</li>
<li>Custom partitions can ONLY be specified for CentOS or RHEL servers, and ONLY on the secondary drives <sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>. Trying to do the same for the primary controller will result in the default partitinoTemplate being applied. Custom partitions also require the arraySize be declared.</li>
</ol>

<pre><code class="language-python">&quot;&quot;&quot;
@author Christopher Gallo
Places an order for a Bare Metal Server
&quot;&quot;&quot;
import SoftLayer
from pprint import pprint as pp



class ordering():

    def __init__(self):

        self.client = SoftLayer.Client()

    def main(self, package_id, location_id, pub_vlan_id='', priv_vlan_id=''):
        &quot;&quot;&quot;
        Places an order for a Bare Metal Instance
        &quot;&quot;&quot;

        &quot;&quot;&quot;These items are required for all servers and have a 0$ cost, some can be upgraded&quot;&quot;&quot;
        required_items = [
            'AUTOMATED_NOTIFICATION',
            'MONITORING_HOST_PING',
            'NOTIFICATION_EMAIL_AND_TICKET',
            'REBOOT_KVM_OVER_IP',
            'NESSUS_VULNERABILITY_ASSESSMENT_REPORTING',
            'UNLIMITED_SSL_VPN_USERS_1_PPTP_VPN_USER_PER_ACCOUNT',
            'REDUNDANT_POWER_SUPPLY',
        ]
        &quot;&quot;&quot;We need bandwidth, at least 1 ip, and the port speed &quot;&quot;&quot;
        network_items = [
            'BANDWIDTH_500_GB',
            '1_IP_ADDRESS',
            '1_GBPS_DUAL_PUBLIC_PRIVATE_NETWORK_UPLINKS_UNBONDED',
        ]
        &quot;&quot;&quot;A disk controller, a duplicate entry for each disk you want, in order, ram, OS and processor chip &quot;&quot;&quot;
        physical_items = [
            'DISK_CONTROLLER_RAID',
            'HARD_DRIVE_2_00_TB_SATA_2',
            'HARD_DRIVE_2_00_TB_SATA_2',
            'HARD_DRIVE_2_00_TB_SATA_2',
            'HARD_DRIVE_2_00_TB_SATA_2',
            'RAM_128_GB_DDR3_1333_REG_2',
            'OS_VSPHERE_ENTERPRISE_PLUS_6_0',
            'INTEL_XEON_2620_2_00'
        ]

        all_items = required_items + network_items + physical_items
        prices = self.gatherPriceIds(package_id, all_items)
        productOrder = {'orderContainers': [
                {'hardware': 
                    [
                        {
                            'domain': u'cgallo.com',
                            'hostname': u'vmware-testing01',
                            'primaryBackendNetworkComponent': {'networkVlan': {'id' : int(priv_vlan_id)}},
                            'primaryNetworkComponent': {'networkVlan': {'id' : int(priv_vlan_id)}}
                        }
                    ],
                    'location': location_id,
                    'packageId': package_id,
                    'prices': prices,
                    'quantity': 1,
                    'storageGroups' : [
                        {
                            'arrayTypeId': 2,
                            'hardDrives': [0,1],
                            'partitionTemplateId' : 1
                        },
                        {
                            'arrayTypeId': 9,
                            'arraySize' : 2000,
                            'hardDrives': [2],
                            'partitions' : [
                                {'name' : '/', 'size': 200, 'isGrow': 0},
                                {'name' : '/boot', 'size': 100},
                                {'name' : '/usr', 'size': 200},
                                {'name' : '/mine', 'size': 200},
                                {'name' : '/media', 'size': 1, 'isGrow': 1},
                            ]

                        },
                        {
                            'arrayTypeId': 9,
                            'hardDrives': [3]
                        }
                    ],
                }
            ]
        }
        pp(productOrder)
        order = self.client['Product_Order'].verifyOrder(productOrder)
        # order = self.client['Product_Order'].placeOrder(productOrder)
        pp(order)


    def listServerPackages(self):
        mask = &quot;mask[type]&quot;
        _filter = {
            'type': {
                'keyName': {'operation': 'BARE_METAL_CPU'},
            },
        }
        result = self.client['Product_Package'].getAllObjects(mask=mask, filter=_filter)

        for product in result:
            print(&quot;%s - %s - %s - %s&quot; % 
                (product['id'],
                 product['name'],
                 product['keyName'],
                 product['type']['keyName'])
            )
            

    def listPartitionTemplates(self):
        mask = &quot;mask[partitionTemplates[data]]&quot;
        result = self.client['SoftLayer_Hardware_Component_Partition_OperatingSystem'].getAllObjects(mask=mask)
        print(&quot;OS Type, Notes&quot;)
        for os_type in result:
            print(&quot;%s - %s&quot; % (os_type['description'],os_type['notes']))
            print(&quot;\tTemplate id, Description&quot;)
            for template in os_type['partitionTemplates']:
                print(&quot;\t%s - %s &quot; % (template['id'],template['description']))
                for partition in template['data']:
                    print(&quot;\t\t%s - %s %s&quot; % 
                        (partition['partitionName'], 
                         partition['partitionSize'], 
                         'Grow' if partition['isGrow'] else '')
                    )

    def listRaidArrayTypes(self):
        result = self.client['SoftLayer_Configuration_Storage_Group_Array_Type'].getAllObjects()
        for raid in result:
            print(&quot;%s - %s - %s Min:%s Max:%s&quot; % 
                (raid['id'], 
                 raid['keyName'], 
                 raid['description'], 
                 raid['minimumDrives'], 
                 raid['maximumDrives'])
            ) 

    def listAvailableVlans(self, dc_id):
        mask = &quot;mask[network,type,primaryRouter[datacenter]]&quot;
        _filter = {
            'networkVlans' : {
                'primaryRouter': {
                    'datacenter' : { 'id': {'operation': dc_id} }
                }
            }
        }
        result = self.client['SoftLayer_Account'].getNetworkVlans(mask=mask,filter=_filter)
        for vlan in result:
            print(&quot;%s - VLAN: %s - Type: %s - %s &quot; % 
                (vlan['id'], 
                 vlan['vlanNumber'],
                 vlan['type']['keyName'], 
                 vlan['primaryRouter']['hostname'])
            )

    def getServerPrices(self, package_id):
        mask = &quot;mask[regions,items[prices],activeServerItems[prices]]&quot;
        # locations = self.client['Product_Package'].getLocations(id=package_id)
        result = self.client['Product_Package'].getObject(mask=mask,id=package_id)
        print(&quot;Location ID, Location Name&quot;)
        for location in result['regions']:
            print(&quot;%s - %s &quot; % (location['location']['location']['id'],location['description']))
        print(&quot;Price ID, description, Monthly Fee, KeyName&quot;)
        for item in result['items']:
            for prices in item['prices']:
                # only print the Default location price. 
                # The ordering system will replace the default price id for you if ordering in a non-usa region.
                if prices['locationGroupId'] is '':
                    # Some software has core restrictions that effect prices
                    if 'capacityRestrictionType' in prices:
                        cores = &quot;%s - %s&quot; % (
                             prices['capacityRestrictionMinimum'], 
                             prices['capacityRestrictionMaximum'])
                        print(&quot;%s, %s - %s cores, $%s, %s &quot; % 
                            (prices['id'],
                             item['description'],
                             cores,prices.get('recurringFee','?'),
                             item['keyName'])
                        )
                    else:
                        print(&quot;%s, %s, $%s, %s &quot; % 
                            (prices['id'],
                              item['description'],
                              prices.get('recurringFee','?'),
                              item['keyName'])
                        )
        print(&quot;======= SERVER ITEMS =======&quot;)
        # serverItems = self.client['Product_Package'].getActiveServerItems(id=package_id)
        print(&quot;Price ID, description, Monthly Fee, KeyName&quot;)
        for item in result['activeServerItems']:
            for prices in item['prices']:
                # only print the Default location price. 
                # The ordering system will replace the default price id for you if ordering in a non-usa region.
                if prices['locationGroupId'] is '':
                    print(&quot;%s, %s, $%s, %s &quot; % 
                        (prices['id'],
                         item['description'],
                         prices.get('recurringFee','?'),
                         item['keyName'])
                    )


    def gatherPriceIds(self,package_id,keyNames):
        # This wont work for prices that have core requirements
        mask = &quot;mask[items[prices],activeServerItems[prices]]&quot;
        items = self.client['Product_Package'].getObject(mask=mask,id=package_id)

        prices = []
        sorted_items = {}

        for item in items['items']:
            for price in item['prices']:
                if price['locationGroupId'] is '': 
                    sorted_items[item['keyName']] = price['id']
        for item in items['activeServerItems']:
            for price in item['prices']:
                if price['locationGroupId'] is '': 
                    sorted_items[item['keyName']] = price['id']

        for keyName in keyNames:
            prices.append({'id': int(sorted_items.get(keyName))})
        return prices

if __name__ == &quot;__main__&quot;:

    main = ordering()

    &quot;&quot;&quot;
    Step 1, find the processor type you want
    269 - Quad E7-4800  Series (6 Drives) - 2U_QUAD_E74800_6_DRIVES : BARE_METAL_CPU
    &quot;&quot;&quot;
    main.listServerPackages()
    package_id = 263

    &quot;&quot;&quot;
    Step 2, collect all the pieces you want to order
    getServerPrices will list out all the keyNames and cost of components
    that can be ordered on a certain package. Will also list the DCs that this
    server is available in.
    &quot;&quot;&quot;
    main.getServerPrices(package_id)
    location_id = 142776

    &quot;&quot;&quot;
    Step 3, customize and place the order
    &quot;&quot;&quot;
    main.listAvailableVlans(location_id)
    pub_vlan_id  = 2137279
    priv_vlan_id = 2137281
    main.listPartitionTemplates()
    main.listRaidArrayTypes()
    main.main(package_id,location_id,pub_vlan_id,priv_vlan_id)

</code></pre>

<h2 id="exceptions-you-might-see">Exceptions you might see</h2>

<ul>
<li>SoftLayerAPIError(SoftLayer_Exception_Order_InvalidStorageGroups):</li>
</ul>

<blockquote>
<p>Defining partitions on secondary storage groups is only allowed for CentOS and Red Hat operating systems.</p>

<blockquote>
<p>Chose the right operating system.</p>
</blockquote>
</blockquote>

<ul>
<li>SoftLayerAPIError(SoftLayer_Exception_Order_InvalidLocation):</li>
</ul>

<blockquote>
<p>The location provided for this order is invalid.</p>

<blockquote>
<p>Choose a correct location, locations should be displayed in getServerPrices()</p>
</blockquote>
</blockquote>

<ul>
<li>SoftLayerAPIError(SoftLayer_Exception_Order_InvalidStorageGroups):</li>
</ul>

<blockquote>
<p>Storage group #1 does not have a grow partition. Each storage group with partitions defined must have a grow partition.</p>

<blockquote>
<p>Make sure your partition has &lsquo;isGrow&rsquo; = 1 at some point.</p>
</blockquote>
</blockquote>

<ul>
<li>SoftLayerAPIError(SoftLayer_Exception_Order_InvalidStorageGroups):</li>
</ul>

<blockquote>
<p>Storage group #1 with size (GB) is smaller than the total partitioned size (501GB).</p>

<blockquote>
<p>You forgot to assign an arraySize.</p>
</blockquote>
</blockquote>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Storage_Group">https://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order_Storage_Group</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
            
        <div class="col-md-6">
            
<div class="panel panel-default">
    <div class="panel-heading" style="padding: 2px 15px;">
        <h4>More Documentation</h4>
    </div>
    <div class="panel-body">
        <a href="https://softlayer.github.com/reference/softlayerapi"><i class="fa fa-link"></i> SoftLayer API Reference<br></a>
        <a href="https://github.com/softlayer/softlayer-java"><i class="fa fa-github"></i> softlayer-java<br></a>
        <a href="https://github.com/softlayer/softlayer-api-perl-client"><i class="fa fa-github"></i> softlayer-perl<br></a>
        <a href="https://github.com/softlayer/softlayer-api-php-client"><i class="fa fa-github"></i> softlayer-php<br></a>
        <a href="https://github.com/softlayer/softlayer-python"><i class="fa fa-github"></i> softlayer-python<br></a>
        <a href="https://github.com/softlayer/softlayer-ruby"><i class="fa fa-github"></i> softlayer-ruby<br></a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading text-center" style="padding: 2px 15px;">
      <a href="https://www.facebook.com/IBMBluemixIaaS/"><i class="fa fa-facebook-square" alt="facebook"></i> </a>
      <a href="https://twitter.com/IBMBluemixIaaS"><i class="fa fa-twitter" alt="twitter"></i> </a>
      <a href="http://www.linkedin.com/company/softlayer-technologies-inc-" alt="linked-in"><i class="fa fa-linkedin-square"></i> </a>
      <a href="https://github.com/softlayer"><i class="fa fa-github" alt="github"></i> </a>
      <a href="irc://irc.freenode.net/softlayer"><i class="fa fa-comment" alt="irc"></i> </a>
    </div>
</div>

        </div>
        <div class="col-md-6">
            <div class="well well-sm" style="word-wrap: break-word;"> 
                <strong>Feedback? <span class="fa fa-comment"/></strong>
                    <p>
                        We would love to hear it<br>
                        <a class="" href="https://github.com/softlayer/api_examples/issues/new?title=Feedback%20for%20python%20-%20Advanced%20Bare%20Metal%20Server%20Ordering&body=Feedback+regarding%3A%20https%3a%2f%2fsoftlayer.github.io%2fpython%2forderBareMetal%2f"><span class="fa fa-github-square"/> Open an issue</a>
                    </p>
            </div>
        </div>

    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2015<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://softlayer.github.io/js/jquery.js"></script>
    <script src="https://softlayer.github.io/js/bootstrap.js"></script>
</body>
</html>

/python/orderBareMetal/
